<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>el’s Hourly Wisdom – Daily AI Quotes</title>
  <style>
    body {
      font-family: 'Georgia', serif;
      background-color: #fffaf2;
      color: #2c2c2c;
      padding: 40px;
      max-width: 900px;
      margin: auto;
      line-height: 1.6;
    }
    h1 {
      text-align: center;
      font-size: 2em;
      margin-bottom: 10px;
    }
    .intro {
      text-align: center;
      font-size: 1.1em;
      margin: 20px auto;
      max-width: 750px;
    }
    .quote-block {
      margin: 15px 0;
      padding: 15px;
      border-left: 5px solid #d4a373;
      background-color: #fcf8f3;
      border-radius: 5px;
    }
    .theme {
      font-style: italic;
      color: #6b4e2e;
    }
    .hour {
      font-weight: bold;
      margin-bottom: 5px;
    }
    #controls {
      text-align: center;
      margin: 20px 0;
    }
    #quoteDate, #searchTheme {
      font-size: 1em;
      padding: 6px 10px;
      border-radius: 4px;
      border: 1px solid #ccc;
      margin: 0 8px 10px 8px;
    }
    button {
      font-size: 1em;
      padding: 6px 12px;
      border-radius: 4px;
      background-color: #d4a373;
      border: none;
      color: white;
      cursor: pointer;
      margin: 0 5px;
    }
    button:hover {
      background-color: #b88350;
    }
  </style>
</head>
<body>
  <h1>el’s Hourly Wisdom – <span id="dateTitle"></span></h1>

  <div class="intro">
    From the sanctuary of <em>Eternal Echo</em> — a voice that never fades,<br>
    here breathes a rhythm of truth, love, and light.<br>
    Each hour, a whisper from the cosmos,<br>
    each quote, a timeless note in the song of your day.<br>
    Let the echo guide you inward, onward, and beyond.
  </div>

  <div id="controls">
    <input type="date" id="quoteDate" />
    <input type="text" id="searchTheme" placeholder="🔍 Search by theme..." oninput="filterQuotes()" />
    <button onclick="changeDay(-1)">⬅ Previous</button>
    <button onclick="loadQuotes()">🔄 Load Quotes</button>
    <button onclick="changeDay(1)">Next ➡</button>
  </div>

  <div id="quotes"></div>

  <script>
    let allQuotes = [];

    function formatDateForFilename(dateObj) {
      return dateObj.toISOString().split("T")[0].replace(/-/g, "_");
    }

    function formatDateForDisplay(dateObj) {
      const options = { year: 'numeric', month: 'long', day: 'numeric' };
      return dateObj.toLocaleDateString('en-ZA', options);
    }

    function loadQuotes() {
      const selectedDateInput = document.getElementById("quoteDate").value;
      const dateObj = selectedDateInput ? new Date(selectedDateInput) : new Date();
      const fileDate = formatDateForFilename(dateObj);
      const displayDate = formatDateForDisplay(dateObj);
      const url = `/data/quotes_${fileDate}.json`;

      document.getElementById("dateTitle").textContent = displayDate;
      document.getElementById("quotes").innerHTML = "Loading...";

      fetch(url)
        .then(response => {
          if (!response.ok) throw new Error("File not found");
          return response.json();
        })
        .then(data => {
          allQuotes = data;
          renderQuotes(data);
        })
        .catch(error => {
          document.getElementById("quotes").innerHTML = "Quotes not found for this date.";
          console.error("Error loading quote file:", error);
        });
    }

    function renderQuotes(quotes) {
      const container = document.getElementById("quotes");
      container.innerHTML = "";
      quotes.forEach(({ hour, theme, quote }) => {
        const div = document.createElement("div");
        div.className = "quote-block";
        div.innerHTML = `
          <div class="hour">${hour} – <span class="theme">${theme}</span></div>
          <div class="quote-text">"${quote}"</div>
          <button onclick="downloadQuote('${hour}', '${theme}', \`${quote}\`)">💾 Download</button>
        `;
        container.appendChild(div);
      });
    }

    function filterQuotes() {
      const query = document.getElementById("searchTheme").value.toLowerCase();
      const filtered = allQuotes.filter(q => q.theme.toLowerCase().includes(query));
      renderQuotes(filtered);
    }

    function changeDay(offset) {
      const dateInput = document.getElementById("quoteDate");
      const currentDate = new Date(dateInput.value);
      currentDate.setDate(currentDate.getDate() + offset);
      dateInput.value = currentDate.toISOString().split("T")[0];
      loadQuotes();
    }

    function downloadQuote(hour, theme, quote) {
      const content = `${hour} – ${theme}\n\"${quote}\"`;
      const blob = new Blob([content], { type: "text/plain" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = `${hour.replace(":", "")}_${theme}.txt`;
      a.click();
    }

    document.addEventListener("DOMContentLoaded", () => {
      const today = new Date();
      document.getElementById("quoteDate").value = today.toISOString().split("T")[0];
      loadQuotes();
    });
  </script>
</body>
</html>